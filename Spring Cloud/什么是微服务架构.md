---
title: 什么是微服务架构
date: 2018-01-16 19:56:24
tags: 微服务
---
# 1、前言
在学习微服务架构之前，我们需要对它的一些基础知识进行了解，希望在此之前读者能有较为扎实的Java web基础。
# 2、什么是微服务架构
简单来说，微服务是一种架构模式，是系统架构上的一种设计风格。它的主旨是将原本部署在同一台主机的的一整个系统分割成多个小型服务，这些服务可以独立的在进程中运行，各服务之间通过Restful api进行进行间的协作通信。被拆分的服务根据原系统中业务的一个或一些耦合度较高的业务进行划分，并且每一个服务都需要维持自身的关于**数据存储、业务开发、自动化测试、以及独立部署机制**。并且最大的特点在于由于有着轻量级的通信协议做基础，因此这些划分出来的微服务可以根据其业务需求使用**不同的语言进行开发**。
# 3、微服务架构的诞生
在传统的企业系统架构中，单体系统的开发方式较为常见，通常分为三个部分开发：
1. 数据库开发
2. 服务器端开发
3. 前端开发

在业务发展的初期，当前的架构模式较为简单，开发、部署、测试的工作量较小。但是随着企业的发展，业务需求越发复杂，系统为了应对复杂的业务需求，对当前系统增加新的业务模块；同时随着前端展现形式的多种多样，服务器端需要向前端提供越来越多的接口模块。不断扩大的业务需求使得整个单体系统变得越来越臃肿，后期维护成本大大提高。单体系统的劣势逐渐凸显出来，由于单体应用部署在一个进程中，而后期更新修改功能时往往有可能会影响其他模块的正确运行从而导致整个单体系统宕机。并且单体系统中各个功能模块的使用场景、并发量、消耗的资源类型等都各有不同，这些资源的利用又相互影响，让我们很难对各个业务模块的系统容量进行较为准确的评估。
因此单体系统的局限性简单来说在于
**：前期可以进行快速的开发、使用，但是随着系统的发展，维护成本会大大提高，且难以控制。**

为了解决单体系统后期演变的臃肿难以维护的问题，微服务架构得以诞生并广受关注。我们将系统中不同的功能模块划分为多个不同的服务，这些服务可以**独立的部署和扩展**。由于每个服务都独立运行在各自的进程中，在部署上有稳固的边界，这样使得每个服务的更新都不会影响其他服务的运行。同时，由于各服务是独立部署的，因此我们可以更为准确的为每个服务评估性能容量。通过配合服务间的协作流程也更容易发现系统的性能瓶颈位置，以及给出更为准确的系统级性能容量评估。
# 4、实现微服务的缺点
在实施微服务之前，我们必须知道，微服务架构虽然有很多优点，但是也因为服务的拆分而在开发微服务系统时引发了诸多在单体系统中没有的问题。

- **运维的新挑战：** 在微服务架构中，运维人员需要维护的进程数会大大增加。有条不紊的将这些进程编排和组织起来不是一件容易的事，对于传统的运维人员来说，他们需要更多的技能来应对这些挑战，运维的过程需要更多的自动化，这就要求运维人员具备一定的开发能力来编排运维过程并让它们自动运行起来。
- **接口的一致性：** 虽然我们拆分了服务，但是业务逻辑之间的依赖并不会消除，这是从原来单体系统中的代码依赖转化为了服务间的通信依赖。当我们对原有接口进行了修改，那么交互方也要协调这种修改进行发布，以保证接口的正确调用。我们需要更完善的接口和版本管理，或者严格遵循开闭原则。
- **分布式的复杂性：** 由于拆分之后的各个微服务都是独立部署并允许在各自的进程中，它们只能通过通信来进行协作，那么分布式环境的问题都将是微服务架构体系设计时必须要考虑的重要因素，比如网络延迟、分布式事务、异步消息等。
尽管微服务架构有很多缺点和问题，但是其实现的敏捷开发和自动化部署等优点依然被广大优秀的架构师和开发者所青睐。所以解决以上问题就是这几年架构大师努力的目标。
# 5、微服务架构的九大特征
## 5.1、服务组件化
组件，是一个可以独立更换和升级的单元。就像PC中的CPU、内存、显卡、硬盘等，独立且可以更换升级而不影响其他单元。

在微服务架构中，需要我们对服务进行组件化分解。服务，是一种进程外的组件，它通过HTTP等通信协议进行协作，而不像传统的组件那样以代码嵌入的方式协同工作。每一个服务都独立开发、部署，可以有效避免一个服务的修改而引起整个系统的重新部署。

打一个不恰当的比喻，如果我们的PC组件以服务的方式进行构建。那么只需要维护主板和一些必要的外设，对于最重要的计算能力通过一组外部服务进行实现。我们只需要告诉PC从哪里来获得计算能力，就可以实现计算能力的组件服务化，我们甚至可以通过改动计算能力服务的地址而完成PC计算能力的升级。
## 5.2、按业务组织团队
当决定如何划分微服务时，通常也意味着我们要对团队进行重新的规划与组织。

按照以往的团队划分方式，我们通常会按照技术层面将团队划分为多个，比如DBA团队、运维团队、测试团队、后端团队、前端团队、设计师团队等。如果我们继续按照这种团队划分方式来实施微服务架构开发时，当有一个服务出现问题需要更改时，可能是一个很简单的改动，但是往往需要从数据存储一直带前端都改动。虽然每个部分需要改动的都很小，但是没这会引起跨团队开发的时间损耗和预算审批。

在实施微服务架构师，需要采用不同的团队分割方法。由于每一个微服务都是针对特定特务的宽栈或是全栈实现，既要负责数据的持久化存储，又要负责用户接口定义等各种跨专业领域的职能。因此，在面对大型项目时，对于微服务团队的拆分更加建议按照业务线进行拆分。一方面可以有效减少服务内部修改所产生的内耗，另一面，团队的边界更为清晰。
## 5.3 做“产品”的态度
在实施微服务架构的团队中，每一个团队都应该以做产品的方式，对其产品的整个生命周期负责。而不是以项目的模式，已完成开发与交付成果交接给维护人员为最终目标。

开发团队通过了解服务在具体生产环境中的部署情况，可以增加他们对具体业务的理解。比如，很多时候，一些业务中发生的特殊或异常情况，很有可能产品经理并不知晓，但细心的开发者很容易通过生产环境尽早发现这些特殊的潜在问题或需求。

所以，我们需要以做“产品”的态度来对待每一个微服务，持续关注服务的运行情况，并不断分析以帮助用户来改善业务功能。
## 5.4、智能端点与哑管道
在单体系统中，组件间直接通过函数调用的方式进行交互协作。而在微服务架构中，由于服务不在同一个进程中，组件间的通信模式发生了改变，若仅仅将原本在进程内的方法调用改成RPC方式的调用，会导致微服务之间繁琐的通信，使得系统表现更为糟糕，所以我们需要更粗粒度的通信协议。

在微服务架构中，通常会使用以下两种服务调用方式：

- 第一种：使用HTTP的 Restful api 或者更为轻量级的消息发送协议，实现信息传递与服务调用的触发。
- 第二种：通过轻量级消息总线上传递消息，类似RabbitMQ等一些提供可靠异步消息通信的中间件。
- 注：在极度强调性能的情况下，有些团队会使用二进制的消息发送协议，例如protobuf。
## 5.5、去中心化治理
在单体系统中，通常在技术平台上都会制定统一的标准，但是每一种技术平台都会有其短板，这会导致在碰到短板是，不得不花费大力气去解决，并且可能因为底层架构的原因，从而造成系统的瓶颈。
在微服务架构时，通过采用轻量级发契约定义接口，使得我们对于服务本身的具体实现平台并不再那么敏感，这样整个微服务架构系统中的各个组件就能针对其不同的业务特点选择不同的技术平台，这样终于不会出现杀鸡用牛刀或是杀牛用指甲钳的尴尬处境了，能极大的发挥系统性能。
> 不是每一个问题都是钉子，不是每一个解决方案都是锤子。
## 5.6、去中心化管理数据
我们在实施微服务架构时，都希望让每一个服务都管理器自由的数据库，这就是数据管理的去中心化。

在去中心化过程中，我们除了将原来的数据库中的存储内容拆分到新的同平台的其他数据库实例中（如把单体系统中存储在一个MySQL数据库中的表拆分之后，按照业务划分所需的数据表而拆分表，分别存储到对应的MySQL实例中）。也可以把一些具有特殊结构或业务特征的数据存储到一些其他技术的数据库实例中（如把日志信息存储到MongoDB中；把用户登录信息存储到Redis中）。

虽然数据管理的去中心化可以让数据管理更加细致化，通过采用更合适的技术可以让数据存储和性能达到最优。但是，由于数据存储到不同的数据库实例中之后，数据一致性也成为微服务架构中需要解决的问题之一。分布式事务本身实现的难度就非常大，所以在微服务架构中，我们更强调在各服务之间进行
**“无事务”**
的调用，而对于数据一致性，只要求数据在最后的处理状态是一致的即可；若在过程中发生错误，通过补偿机制来进行处理，使得错误数据能够达到最终的一致性。
## 5.7、基础设施自动化
近年来云计算服务和容器技术的不断成熟，运维基础设施的工作变得越来越容易。但是，当我们实施微服务架构时，数据库、应用程序的体量虽然变小了，但是由于拆分的原因，数量上成倍的增长。这使得运维人员需要关注的内容也成倍的增长，并且操作性任务也会成倍的增长，这些问题若没有得到妥善的处理，必将会成为运维人员的噩梦。

所以，在微服务架构中，必须从一开始就构建起
**“持续交付”**
平台来支撑整个实施过程，该平台需要两大内容，缺一不可。
1. **自动化测试：** 每次部署前的强心剂，尽可能地获得对正在运行的软件的信息。
2. **自动化部署：**
解放繁琐枯燥的重复操作和对多环境的配置管理。
## 5.8、容错设计
在单体系统中，一般不存在单个系统故障而其他组件还在运行的情况，通常是一挂全挂。而在微服务架构中，由于每个服务都是独立运行在进程中，所以存在部分服务故障，而其他服务正常运行的情况，或者由于消息通信与业务上的依赖而出现故障的蔓延。

所以，在微服务架构中，快速检测数故障源并尽可能的自动恢复服务是必须被设计和考虑的。通常，我们都希望在每个服务中实现监控和日志记录的组件，比如服务状态、断路由器状态、网络延迟、吞吐量等关键数据的仪表盘等。
## 5.9、演进式设计
通过上面几点特点，我们已经体会到，要实施一个完美的微服务架构，需要考虑的设计与成本并不小，对于没有足够经验的团队来说，甚至要比单体系统付出更大的代价。

所以一般情况下，架构师都会以演进的方式进行系统的构建。在初期，以单体系统的方式的方式来设计和实施，一方面系统的体量初期并不会很大，构建和维护成本都不高。另一方面，初期的核心业务在后期通常不会有很大的变化，随着系统的发展或者业务的需要，架构师会将一些经常变动或者是有一定时间效应的内容进行微服务处理，并逐渐将原来单体系统中多变的模块逐步拆分出来，而稳定不太变化的模块就形成一个核心微服务存在于整个架构中。自此整个系统由单体系统演变成微服务架构系统。


---

在本节，我们大致了解了什么是微服务架构，单体系统与微服务架构系统之间的优缺点，那么在下一节我们将学习==为何要选择Spring Cloud作为微服务架构技术栈？==