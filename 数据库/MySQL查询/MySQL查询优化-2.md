---
title: MySQL查询优化（二）
date:  2018-09-15 16:56:24
tags: MySQL
---
<meta name="referrer" content="no-referrer" />
# 以下介绍几种常用的SQL查询优化方法

**对查询进行优化，应尽量避免全表扫描**
- 11、在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。
- 12、不要写一些没有意义的查询，如需要生成一个空表结构：

```
　select col1,col2 into #t from t where 1=0
```
这类代码不会返回任何结果集，但是会消耗系统资源的。

修改策略：

```
create table #t(...)
```
- 13、很多时候用 exists 代替 in 是一个好的选择：


```
select num from a where num in(select num from b)
```
修改策略：

```
select num from a where exists(select 1 from b where num=a.num)
```
- 14、并不是所有索引对查询都有效，SQL是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL查询可能不会去利用索引。

如一表中有字段sex，male、female几乎各一半，那么即使在sex上建了索引也对查询效率起不了作用。

- 15、索引并不是越多越好，索引固然可以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率。

因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。

一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有必要。

- 16、应尽可能的避免更新 clustered 索引（聚集索引）数据列，因为 clustered 索引数据列的顺序就是表记录的物理存储顺序，一旦该列值改变将导致整个表记录的顺序的调整，会耗费相当大的资源。

若应用系统需要频繁更新 clustered 索引数据列，那么需要考虑是否应将该索引建为 clustered 索引。

- 17、尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。

这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了。

- 18、尽可能的使用 varchar/nvarchar 代替 char/nchar。

因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。

- 19、任何地方都不要使用 select * from t ，用具体的字段列表代替“*”，不要返回用不到的任何字段。

- 20、尽量使用表变量来代替临时表。如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。